{
  "sql": "WITH temporal_success AS (\n    SELECT\n        BUBBLES,\n        PURCHASE_DATE_RANGE,\n        COUNT(*) as attempts,\n        COUNT(DISTINCT INDIVIDUALID) as unique_individuals,\n        SUM(CASE WHEN TARGET = 1 THEN 1 ELSE 0 END) as successes,\n        SUM(CASE WHEN PRES_KIDS = TRUE THEN 1 ELSE 0 END) as with_kids,\n        AVG(CASE WHEN CREDIT_RATING IS NOT NULL OR PART_AFFILIATION IS NOT NULL THEN 1 ELSE 0 END) as enriched_data_ratio\n    FROM DM_CAMPAIGN\n    WHERE BUBBLES IN ('Working for the Weekend', 'Date Nights City Lights', 'Urban Elites', 'Social Climbers')\n    GROUP BY BUBBLES, PURCHASE_DATE_RANGE\n    HAVING attempts >= 10\n),\ntrend_analysis AS (\n    SELECT\n        BUBBLES,\n        PURCHASE_DATE_RANGE,\n        attempts,\n        unique_individuals,\n        successes,\n        ROUND((successes::FLOAT / attempts) * 100, 2) as success_rate,\n        ROUND((with_kids::FLOAT / attempts) * 100, 2) as kids_percentage,\n        ROUND(enriched_data_ratio * 100, 2) as enriched_data_pct,\n        LAG(successes::FLOAT / attempts) OVER (PARTITION BY BUBBLES ORDER BY PURCHASE_DATE_RANGE) as prev_success_rate\n    FROM temporal_success\n)\nSELECT\n    BUBBLES,\n    MIN(PURCHASE_DATE_RANGE) as first_date,\n    MAX(PURCHASE_DATE_RANGE) as last_date,\n    COUNT(*) as time_periods,\n    AVG(success_rate) as avg_success_rate,\n    STDDEV(success_rate) as success_rate_volatility,\n    CORR(success_rate, kids_percentage) as kids_correlation,\n    CORR(success_rate, enriched_data_pct) as data_quality_correlation,\n    AVG(CASE WHEN success_rate > COALESCE(prev_success_rate, 0) THEN 1 ELSE 0 END) as improvement_ratio\nFROM trend_analysis\nGROUP BY BUBBLES\nORDER BY avg_success_rate DESC",
  "reasoning": "This query focuses on temporal patterns and success drivers in our top-performing segments, addressing several key questions from our previous findings:\n\n1. Temporal Stability:\n- Analyzes success rate volatility over time\n- Tracks improvement ratios to understand if segments are getting better\n- Examines the time span of campaigns in each bubble\n\n2. Success Correlations:\n- Investigates relationship between kids presence and success rates\n- Studies whether enriched data (credit/political) actually helps performance\n- Looks at success rate trends relative to data quality\n\n3. Segment Comparison:\n- Focuses on our identified top performers to understand their differences\n- Compares volatility and stability across segments\n- Examines whether success patterns are consistent or varying\n\nThis query should help us understand:\n- Whether successful segments maintain their performance over time\n- If data enrichment actually correlates with better performance\n- Whether demographic factors like kids presence are consistent predictors\n- Which segments show the most stable vs volatile performance\n\nThis builds on our previous findings about the 'Working for the Weekend' segment's surprising success and helps validate whether its performance is sustainable or just a statistical artifact."
}